# Development Dockerfile for KAIROS
FROM node:18-alpine3.20

# Arbeitsverzeichnis setzen
WORKDIR /app

# System-Abh채ngigkeiten f체r native Module installieren
RUN apk add --no-cache python3 make g++ git

# Nicht-root User erstellen
RUN addgroup -g 1001 -S nodejs
RUN adduser -S kairos -u 1001

# Package.json und package-lock.json kopieren
COPY package*.json ./

# Alle Abh채ngigkeiten installieren (inkl. dev-dependencies)
RUN npm ci

# Prisma files kopieren
COPY prisma ./prisma/

# Prisma Client generieren
RUN npx prisma generate

# Verzeichnisse erstellen und Berechtigungen setzen
RUN mkdir -p ./models ./data ./logs ./dist ./src
RUN chown -R kairos:nodejs /app

# Zu nicht-root User wechseln
USER kairos

# Port exponieren
EXPOSE 3000

# Startbefehl f체r Development (mit watch mode)
CMD ["npm", "run", "start:dev"]

# Labels
LABEL org.opencontainers.image.title="KAIROS Development"
LABEL org.opencontainers.image.description="Development container for KAIROS"
LABEL org.opencontainers.image.version="1.0.0-dev"
